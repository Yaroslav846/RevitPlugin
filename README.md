# Калькулятор отделки помещений для Revit

Это плагин для Autodesk Revit (оригинальное название "Калькулятор Отделки"), предназначенный для автоматизации расчета отделочных материалов в помещениях. Он вычисляет чистую площадь поверхности стен (за вычетом дверей и окон) и периметр пола (для расчета длины плинтуса) для всех помещений в проекте Revit.

## Возможности

-   **Чистая площадь стен:** Автоматически рассчитывает общую площадь поверхности стен в каждом помещении.
-   **Вычет проемов:** Корректно вычитает площадь размещенных в стенах дверей и окон из расчета площади стен.
-   **Длина плинтуса/периметр:** Рассчитывает общую длину периметра помещения по уровню пола.
-   **Интерактивный интерфейс:** Удобное немодальное окно (WPF) позволяет одновременно работать с калькулятором и моделью Revit.
-   **Таблица данных:** Отображает результаты в наглядной таблице с возможностью поиска и фильтрации.
-   **3D-визуализация:** Выберите любое помещение в таблице результатов и нажмите "Выделить в 3D", чтобы увидеть точные рассчитанные поверхности стен, подсвеченные как элементы `DirectShape` в активном 3D-виде.
-   **Экспорт данных в Revit:** Записывайте рассчитанные значения площади и периметра напрямую в указанные текстовые параметры соответствующих элементов `Room` (Помещение) в вашей модели.
-   **Настраиваемые параметры:** Используйте окно "Настройки", чтобы точно задать имена параметров, в которые вы хотите записать данные.

## Как использовать

1.  **Запуск плагина:** Перейдите на вкладку "Надстройки" на ленте Revit и нажмите кнопку "Отделка помещений".
2.  **Расчет:** В окне плагина нажмите кнопку "Рассчитать". Таблица заполнится данными об отделке для всех помещений в проекте.
3.  **Просмотр данных:** Вы можете сортировать данные, нажимая на заголовки столбцов, или использовать поле поиска для фильтрации по конкретным помещениям (например, по имени или номеру).
4.  **Выделение в 3D (опционально):
    -   Откройте 3D-вид в вашем проекте.
    -   В окне плагина выберите одно или несколько помещений из таблицы.
    -   Нажмите кнопку "Выделить в 3D". Рассчитанные поверхности стен для выбранных помещений будут показаны как временная цветная геометрия.
5.  **Настройка параметров:**
    -   Нажмите кнопку "Настройки".
    -   Введите имена параметров Revit, в которые вы хотите сохранить площадь стен и длину плинтуса. Это должны быть параметры с типом данных `Текст`, которые вы уже добавили к категории `Room` (Помещение) в вашем проекте.
    -   Нажмите "Сохранить".
6.  **Запись данных в Revit:**
    -   Убедившись, что настройки верны, нажмите кнопку "Записать в Revit".
    -   Плагин запишет рассчитанные значения в указанные параметры для каждого помещения.

## Сборка и установка

Этот плагин разработан для **Revit 2026** с использованием фреймворка **.NET 8.0**.

### Требования

-   ОС Windows
-   Autodesk Revit 2026
-   Microsoft Visual Studio 2022 или новее
-   .NET 8.0 SDK

### Сборка проекта

1.  Клонируйте или скачайте этот репозиторий.
2.  Откройте `RevitPlugin.sln` в Visual Studio.
3.  Проект ссылается на `RevitAPI.dll` и `RevitAPIUI.dll`. Файл `.csproj` настроен на их поиск по пути `C:\Program Files\Autodesk\Revit 2026\`. Если ваш Revit установлен в другом месте, вам потребуется обновить эти пути в файле `.csproj`.
4.  Соберите решение (Сборка > Собрать решение). Это создаст файл `RevitPlugin.dll` в папке `bin\Debug` (или `bin\Release`).

### Установка

Чтобы установить плагин для использования в Revit, необходимо поместить два основных файла в специальную папку надстроек Revit:

1.  **Манифест плагина (`.addin`):** Этот файл сообщает Revit, как загрузить ваш плагин.
2.  **Библиотека плагина (`.dll`):** Это скомпилированный код вашего плагина.

Выполните следующие шаги:

1.  **Найдите папку надстроек Revit.** Путь к этой папке обычно следующий:
    `%APPDATA%\Autodesk\Revit\Addins\2026\`
    *(Замените `2026` на вашу версию Revit, если она отличается)*.

2.  **Скопируйте файл манифеста (`.addin`):**
    -   Найдите файл `RoomFinishes.addin` в папке `RoomFinishesPlugin` вашего проекта.
    -   Скопируйте этот файл в папку надстроек Revit, которую вы нашли на шаге 1.

3.  **Скопируйте библиотеку плагина (`.dll`):**
    -   После сборки проекта в Visual Studio, найдите файл `RevitPlugin.dll` в одной из следующих папок:
        -   `bin\Release\net8.0-windows\`
        -   `bin\Debug\net8.0-windows\`
    -   Скопируйте файл `RevitPlugin.dll` в ту же папку надстроек Revit, куда вы скопировали `.addin` файл.

4.  **Запустите Revit.** Кнопка "Отделка помещений" должна появиться на вкладке "Надстройки".

**Важно:** Файл `RoomFinishes.addin` настроен так, чтобы искать `RevitPlugin.dll` в той же папке, где он сам находится. Поэтому оба файла должны быть размещены вместе в папке `%APPDATA%\Autodesk\Revit\Addins\2026\`.

---
**Примечание:** Если вы столкнулись с проблемами, убедитесь, что все необходимые файлы были скопированы, а путь к папке дополнений Revit выбран правильно.

## Структура проекта

-   `App.cs`: Основная точка входа для плагина. Создает вкладку и кнопку на ленте при запуске Revit.
-   `Command.cs`: Команда `IExternalCommand`, которая выполняется при нажатии кнопки на ленте и отвечает за запуск основного интерфейса.
-   `RoomFinishesPlugin/`: Папка, содержащая основную логику и интерфейс плагина.
    -   `RoomProcessor.cs`: Сердце плагина. Содержит статические методы для выполнения сложных геометрических расчетов.
    -   `RoomWindow.xaml` и `RoomWindow.xaml.cs`: Определяет основной пользовательский интерфейс (окно WPF) и его логику, включая обработчики событий и координацию с Revit API.
    -   `SettingsWindow.xaml` и `SettingsWindow.xaml.cs`: Интерфейс и логика для диалогового окна настроек, где пользователи настраивают имена целевых параметров.
    -   `PluginSettings.cs`: Обрабатывает сохранение и загрузку пользовательских настроек.
    -   `CalculateHandler.cs`, `WriteHandler.cs`, `HighlightHandler.cs`: Эти классы реализуют интерфейс `IExternalEventHandler` Revit для безопасного выполнения операций в основном контексте Revit при вызове из немодального интерфейса.
    -   `RoomFinishes.addin`: Файл манифеста, который сообщает Revit, как загружать плагин.